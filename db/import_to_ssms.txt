USE gehoortest;

-- Create 'branch' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'branch')
BEGIN
    CREATE TABLE branch (
        id INT NOT NULL IDENTITY(1,1),
        name NVARCHAR(50) NOT NULL,
        deleted BIT NOT NULL DEFAULT 0,
        PRIMARY KEY (id)
    );
END;

-- Create 'employee_login' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'employee_login')
BEGIN
    CREATE TABLE employee_login (
        id INT NOT NULL IDENTITY(1,1),
        employee_number NVARCHAR(50) NULL,
        full_name NVARCHAR(50) NULL,
        email NVARCHAR(50) NOT NULL,
        password CHAR(64) NOT NULL,
        active BIT NOT NULL DEFAULT 1,
        PRIMARY KEY (id)
    );
END;

-- Create 'employee_branch' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'employee_branch')
BEGIN
    CREATE TABLE employee_branch (
        employee_id INT NOT NULL,
        branch_id INT NOT NULL,
        PRIMARY KEY (employee_id, branch_id),
        FOREIGN KEY (employee_id) REFERENCES employee_login (id),
        FOREIGN KEY (branch_id) REFERENCES branch (id)
    );
END;

-- Create 'test' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'test')
BEGIN
    CREATE TABLE test (
        id INT NOT NULL IDENTITY(1,1),
        title NVARCHAR(50) NOT NULL,
        employee_id INT NOT NULL,
        test_data NVARCHAR(MAX) NOT NULL,
        active BIT NOT NULL DEFAULT 0,
        deleted BIT NOT NULL DEFAULT 0,
        PRIMARY KEY (id),
        FOREIGN KEY (employee_id) REFERENCES employee_login (id)
    );
END;

-- Create 'target_audience' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'target_audience')
BEGIN
    CREATE TABLE target_audience (
        id INT NOT NULL IDENTITY(1,1),
        [from] TINYINT NULL,
        [to] TINYINT NULL,
        label NVARCHAR(50) NOT NULL,
        PRIMARY KEY (id)
    );
END;

-- Create 'test_target_audience' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'test_target_audience')
BEGIN
    CREATE TABLE test_target_audience (
        test_id INT NOT NULL,
        target_audience_id INT NOT NULL,
        PRIMARY KEY (test_id, target_audience_id),
        FOREIGN KEY (target_audience_id) REFERENCES target_audience (id),
        FOREIGN KEY (test_id) REFERENCES test (id)
    );
END;

-- Create 'client_login' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'client_login')
BEGIN
    CREATE TABLE client_login (
        id INT NOT NULL IDENTITY(1,1),
        email NVARCHAR(50) NOT NULL,
        password CHAR(64) NOT NULL,
        PRIMARY KEY (id)
    );
END;

-- Create 'test_result' table
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'test_result')
BEGIN
    CREATE TABLE test_result (
        id INT NOT NULL IDENTITY(1,1),
        test_id INT NOT NULL,
        branch_id INT NOT NULL,
        client_id INT NULL,
        start_date_time DATETIME NOT NULL,
        test_duration INT NOT NULL,
        test_answers NVARCHAR(MAX) NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (test_id) REFERENCES test (id),
        FOREIGN KEY (branch_id) REFERENCES branch (id),
        FOREIGN KEY (client_id) REFERENCES client_login (id)
    );
END;
